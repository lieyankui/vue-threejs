<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>国旗</title>
    <style>
      body,
      html {
        width: 100%;
        height: 100%;
      }
      body {
        padding: 10px;
      }
      * {
        margin: 0;
        padding: 0;
        outline: none;
        box-sizing: border-box;
      }
      h1 {
        text-align: center;
        color: #ee1c25;
      }
      .canvas-container {
        max-width: 600px;
        max-height: 400px;
        margin: 100px auto;
        box-shadow: 3px 3px 20px 1px red;

        @media screen and (max-width: 600px) {
          width: auto;
          height: auto;
        }
      }
      .canvas-container canvas {
        display: block;
      }
    </style>
  </head>
  <body>
    <h1>国旗</h1>
    <div class="canvas-container">
      <canvas></canvas>
    </div>

    <script>
      const container = document.querySelector(".canvas-container");
      const canvas = document.querySelector(".canvas-container canvas");
      const wnum = 30;
      const hnum = 20;
      let unit = 0;
      const bgColor = "#ee1c25";
      const starColor = "#ffff00";

      window.onload = function () {
        init();
        window.addEventListener("resize", () => {
          init();
        });
      };
      function init() {
        initCanvasSize();
        draw();
      }
      function initCanvasSize() {
        const { width, height } = container.getBoundingClientRect();
        canvas.width = width;
        canvas.height = width * 2 / 3;
        // 单位长度
        unit = width / 30;
      }
      function draw() {
        if (canvas.getContext) {
          const ctx = canvas.getContext("2d");
          drawBg(ctx);
          drawStars(ctx);
        } else {
          alert("Your browser is too lower!!!");
        }
      }

      function drawBg(ctx) {
        const { width, height } = canvas;
        ctx.fillStyle = bgColor;
        ctx.fillRect(0, 0, width, height);
      }
      function drawStars(ctx) {
        const r1 = 3;
        const r2 = 1;
        const bigStarCenter = [5, 5];
        const smallStarCenters = [
          [10, 2, r2],
          [12, 4, r2],
          [12, 7, r2],
          [10, 9, r2],
        ];
        //
        drawStar(ctx, 5, 5, r1);
        smallStarCenters.forEach(([x, y, r]) => {
          // 辅助线
          // ctx.beginPath();
          // ctx.moveTo(x * unit, y * unit);
          // ctx.lineTo(bigStarCenter[0] * unit, bigStarCenter[1] * unit);
          // ctx.strokeStyle = starColor;
          // ctx.stroke();
          drawStar(
            ctx,
            x,
            y,
            r,
            atan((y - bigStarCenter[1]) / (x - bigStarCenter[0])) - getAngle(90)
          );
        });
      }

      function drawStar(ctx, x, y, r, deg) {
        const smallR = getSmallR(r);
        ctx.save();
        ctx.translate(x * unit, y * unit);
        if (deg) {
          ctx.rotate(deg);
        }
        const pointsArr = [];
        for (let i = 0; i < 5; i++) {
          const r1 = 90 + i * 72;
          const r2 = 126 + i * 72;
          pointsArr.push(reverseY([cos(r1) * r * unit, sin(r1) * r * unit]));
          pointsArr.push(
            reverseY([cos(r2) * smallR * unit, sin(r2) * smallR * unit])
          );
        }
        ctx.beginPath();
        pointsArr.forEach((point) => {
          const [x, y] = point;
          ctx.lineTo(x, y);
        });
        ctx.closePath();
        ctx.fillStyle = starColor;
        ctx.fill();
        ctx.restore();
      }

      function reverseY([x, y]) {
        return [x, -y];
      }

      function sin(deg) {
        return Math.sin(getAngle(deg));
      }
      function cos(deg) {
        return Math.cos(getAngle(deg));
      }
      function tan(deg) {
        return Math.tan(getAngle(deg));
      }
      function atan(num) {
        return Math.atan(num);
      }
      function getSmallR(bigR) {
        return (bigR * sin(18)) / cos(36);
      }

      function clear(ctx) {
        const { width, height } = canvas;
        ctx.clearRect(0, 0, width, height);
      }

      function getAngle(angleNum) {
        angleNum = parseFloat(angleNum);
        return (angleNum * Math.PI) / 180;
      }
    </script>
  </body>
</html>
